import{escapeRegExp as e,gsub as r,regExpToString as n}from"./template.js";import{VerboseRegExp as t}from"./utils/verbose-regexp.js";function o(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function a(){return"undefined"!=typeof CustomEvent}function s(e){return"string"==typeof e}function c(e){return Array.isArray(e)?e:[e]}function l(e,r,n,t={}){let o;t=Object.assign({startIndex:0,startDepth:0,considerEscapes:!0},t);let{startIndex:a,startDepth:s,considerEscapes:c}=t,l=r.length,p=n.length,u=e.length;for(let t=a;t<u;t++){t>0&&(o=e.slice(t-1,t));let a=!!c&&"\\"===o,u=e.slice(t,t+l);if(e.slice(t,t+p)!==n||a||s++,u===r&&!a&&(s--,0===s))return t}return-1}function p(e){return e=(e=e.replace(/^[\s\t]*/gm,"")).replace(/\n/g,"")}function u(e,r){return e?`<span class="${r}">${e}</span>`:""}function f(e,r,n){let t,s;t=performance.now(),performance.mark&&performance.mark("daub-lexer-before");let c=r.run(e,n);if(s=performance.now(),performance.mark&&(performance.mark("daub-lexer-after"),performance.measure("daub-lexer-before","daub-lexer-after")),!o()&&a()){let e=new CustomEvent("daub-lexer-time",{bubbles:!0,detail:s-t});document.dispatchEvent(e)}return c.lengthConsumed-1}function i(e,r,n){let t,s;t=performance.now(),performance.mark&&performance.mark("daub-lexer-before");let c=r.run(e,n,{highlight:!0});if(s=performance.now(),performance.mark&&(performance.mark("daub-lexer-after"),performance.measure("daub-lexer-before","daub-lexer-after")),!o()&&a()){let e=new CustomEvent("daub-lexer-time",{bubbles:!0,detail:s-t});document.dispatchEvent(e)}let l=d(c);return{index:c.lengthConsumed-1,highlighted:l}}function m(e){let r=[];e=c(e);for(let n of e)if(s(n))r.push(n);else if(n.content){let e=m(c(n.content));r.push(...e)}return r.join("")}function b(e){let r=[];if(s(e))return[e];if(e.content)if(s(e.content))r.push({name:e.name,scopes:e.scopes,content:e.content});else{e.scopes&&r.push({open:e.scopes});for(let n of c(e.content))r.push(...b(n));e.scopes&&r.push({close:e.scopes})}return r}function d(e){return b(e).map((e=>{let r;if(s(e))return e;if(e.open)r=s(e.open)?`<span class="${e.open}">`:"";else if(e.close)r=s(e.close)?"</span>":"";else{let n=e.scopes||e.name;r=n?`<span class="${n}">${e.content}</span>`:e.content}return r})).join("")}var h=Object.freeze({__proto__:null,VerboseRegExp:t,balance:l,balanceAndHighlightByLexer:i,balanceByLexer:f,compact:p,escapeRegExp:e,gsub:r,regExpToString:n,renderLexerTree:d,serializeLexerFragment:m,wrap:u});export{i as a,l as b,p as c,f as d,d as r,m as s,h as u,u as w};
